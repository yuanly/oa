<html>
	<head>
	<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
	<script src="js/jquery-1.9.1.js"></script>
	<script type="text/javascript">
		$(function(){ 
			var cfg={clientWidth:document.body.clientWidth,clientHeight:document.body.clientHeight};
			cfg.piece=[{percent:5,bgColor:"#FF0FF0",txt:"一等奖 "},
				{percent:20,bgColor:"#0BEE0F",txt:"再接再厉 ",txtColor:"brown"},
				{percent:10,bgColor:"#0BE0EF",txt:"二等奖 ",txtColor:"black"},
				{percent:18,bgColor:"#F0BEE0",txt:"再接再厉 ",txtColor:"black"},
				{percent:15,bgColor:"#0EBE0F",txt:"三等奖 ",txtColor:"black"},
				{percent:12,bgColor:"#0B0EEF",txt:"再接再厉 ",txtColor:"black"},
				{percent:15,bgColor:"#0EBFE0",txt:"三等奖 ",txtColor:"black"},
				{percent:5,bgColor:"#E0F0BE",txt:"再接再厉 ",txtColor:"black"}];
			cfg.centerColor="#cc9900";
			if(cfg.clientWidth>cfg.clientHeight){
				cfg.width = cfg.clientHeight;
				$("#dishDiv").css("width",cfg.width+"px").css("height",cfg.width+"px");
				$("#dishCanvas").css("width",cfg.width+"px").css("height",cfg.width+"px");
				$("#dishDiv").css("left",(cfg.clientWidth-cfg.width)/2+"px");
				$("#pointerCanvas").attr("width",cfg.clientWidth).attr("height",20);
			}else{
				cfg.width = cfg.clientWidth;
				$("#dishDiv").css("width",cfg.width+"px").css("height",cfg.width+"px");
				$("#dishCanvas").css("width",cfg.width+"px").css("height",cfg.width+"px");
				$("#dishDiv").css("top",(cfg.clientHeight-cfg.width)/2+"px");
				$("#pointerCanvas").css("top",(cfg.clientHeight-cfg.width)/2+"px").attr("width",cfg.clientWidth).attr("height",20);
			}
			pointer(cfg);
			dish(cfg);	
		});

		function dish(cfg){
			var c=document.getElementById("dishCanvas");
			var ctx=c.getContext("2d");
			ctx.translate(500,500);
			draw(cfg,ctx,0);
		}
		/*
		* ctx: canvas context
		* s: start angle
		* e: end angle
		* color: background-color
		* txt: text
		* txtColor: text color
		*/
		function arc(ctx,s,e,color,txt,txtColor){
			ctx.fillStyle=color;
			ctx.beginPath();
			while(s>2){s=s-2;}
			while(e>2){e=e-2;}
			ctx.arc(0,0,500,Math.PI*s,Math.PI*e);
			ctx.lineTo(0,0);
			ctx.closePath();
			ctx.fill();	
			
			if(txt){
				if(txtColor){
					ctx.fillStyle=txtColor;
				}else{
					ctx.fillStyle="#000";
				}
				ctx.textBaseline="middle";
				ctx.rotate(Math.PI*(s+e)/2);
				ctx.font="45px Arial";
				ctx.textAlign="right";
				ctx.fillText(txt,500,0);
				ctx.rotate(-Math.PI*(s+e)/2);
			}
		}
		function arc1(ctx,sAngle,piece){
			var eAngle = sAngle+2*piece.percent/100;
			arc(ctx,sAngle,eAngle,piece.bgColor,piece.txt,piece.txtColor);
			return eAngle;
		}
		function draw(cfg,ctx,deg){
			var sAngle = deg-0.5;
			$.each(cfg.piece,function(i,piece){
				sAngle = arc1(ctx,sAngle,piece);
			});
			if(sAngle<2){
				arc(ctx,sAngle,1.5,"#eee"); 
			}
			 
			ctx.fillStyle=cfg.centerColor;
			ctx.beginPath();
			ctx.arc(0,0,150,Math.PI*0,Math.PI*2);
			ctx.lineTo(0,0);
			ctx.closePath();
			ctx.fill();
				
		}
		function pointer(cfg){
			var c=document.getElementById("pointerCanvas");
			var ctx=c.getContext("2d");
			ctx.fillStyle="#FF0000";
			ctx.moveTo(cfg.clientWidth/2-5,0);
			ctx.beginPath();
			ctx.lineTo(cfg.clientWidth/2,20);
			ctx.lineTo(cfg.clientWidth/2+5,0);
			ctx.lineTo(cfg.clientWidth/2-5,0);
			ctx.closePath(); 
			ctx.fill();
		}
	function onload(){
		pointer();
		var c=document.getElementById("myCanvas");
		var ctx=c.getContext("2d");
		draw(ctx,0);		
		var d = 0;
		function rotate(){
			d += 0.04;
			if(d>2){d=d-2}
			draw(ctx,d);		
		}
		//setInterval(rotate,20);
	}
	</script>
	<style>
		*{
			margin:0px;
			padding:0px
		}
	</style>
	</head>
<body>
<canvas id="pointerCanvas" width="1000" height="20" style="position:absolute;z-index:100;border:0px solid #c3c3c3;">
	Your browser does not support the canvas element.
</canvas>
<div id="dishDiv" style="position:relative;background-color:gray;height:300px;-webkit-transform:rotate(0deg);">
<canvas id="dishCanvas" width="1000" height="1000" style="border:0px solid #c3c3c3;">
	Your browser does not support the canvas element.
</canvas>
</div> 
</body>
</html>